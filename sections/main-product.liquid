{% comment %}
  MACHINIST THEME: Main Product Section (PDP)
{% endcomment %}

<section class="pdp" data-section-id="{{ section.id }}">
  <product-gallery class="pdp__gallery">
    <div class="pdp__main-image">
      {%- if product.featured_image != blank -%}
        <img
          id="main-image-{{ section.id }}"
          data-main-image
          src="{{ product.featured_image | image_url: width: 1000 }}"
          alt="{{ product.featured_image.alt | default: product.title | escape }}"
          width="1000"
          height="600"
          loading="eager"
        >
      {%- else -%}
        {{ 'product-1' | placeholder_svg_tag: 'pdp__placeholder' }}
      {%- endif -%}
    </div>

    {%- if product.images.size > 1 -%}
      <div class="pdp__thumbnails">
        {%- for image in product.images -%}
          <div
            class="pdp__thumb {% if forloop.first %}active{% endif %}"
            data-thumbnail
            data-src="{{ image | image_url: width: 1000 }}"
          >
            <img
              src="{{ image | image_url: width: 200 }}"
              alt="{{ image.alt | default: product.title | escape }}"
              width="200"
              height="120"
              loading="lazy"
            >
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </product-gallery>

  <div class="pdp__details">
    <nav class="breadcrumbs">
      <a href="{{ routes.root_url }}">HOME</a>
      <span class="breadcrumbs__separator">//</span>
      {%- if collection -%}
        <a href="{{ collection.url }}">{{ collection.title | upcase }}</a>
        <span class="breadcrumbs__separator">//</span>
      {%- endif -%}
      <span class="breadcrumbs__current">{{ product.title | upcase }}</span>
    </nav>

    <h1 class="pdp__title txt-heading">{{ product.title }}</h1>

    <div class="pdp__price" id="price-{{ section.id }}">
      <span class="price price--large" data-price>{{ product.price | money }}</span>
      {%- if product.compare_at_price > product.price -%}
        <span class="price price--compare" data-compare-price>{{ product.compare_at_price | money }}</span>
      {%- endif -%}
    </div>

    <div class="pdp__description">
      <p class="txt-body">{{ product.description }}</p>
    </div>

    {%- form 'product', product, id: 'product-form', class: 'pdp__form' -%}
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

      {%- if product.has_only_default_variant == false -%}
        <variant-selector data-section="{{ section.id }}" data-url="{{ product.url }}">
          {%- for option in product.options_with_values -%}
            <div class="pdp__option form-field">
              <label class="form-label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                {{ option.name | upcase }}
              </label>
              <select
                id="Option-{{ section.id }}-{{ forloop.index0 }}"
                class="form-input"
                name="options[{{ option.name }}]"
              >
                {%- for value in option.values -%}
                  <option
                    value="{{ value }}"
                    {% if option.selected_value == value %}selected{% endif %}
                  >
                    {{ value }}
                  </option>
                {%- endfor -%}
              </select>
            </div>
          {%- endfor -%}

          <script type="application/json">
            {{ product.variants | json }}
          </script>
        </variant-selector>
      {%- endif -%}

      <quantity-input class="quantity-selector pdp__quantity">
        <button type="button" class="quantity-selector__button" name="minus" aria-label="Decrease quantity">-</button>
        <input
          type="number"
          class="quantity-selector__input"
          name="quantity"
          value="1"
          min="1"
          aria-label="Quantity"
        >
        <button type="button" class="quantity-selector__button" name="plus" aria-label="Increase quantity">+</button>
      </quantity-input>

      <add-to-cart-button>
        <button
          type="submit"
          class="btn btn--full pdp__add-btn"
          {% unless product.available %}disabled{% endunless %}
        >
          <span class="btn__text">
            {%- if product.available -%}
              {{ 'products.product.add_to_cart' | t }} [ENTER]
            {%- else -%}
              {{ 'products.product.sold_out' | t }}
            {%- endif -%}
          </span>
        </button>
      </add-to-cart-button>
    {%- endform -%}

    {%- if section.settings.show_specs -%}
      <accordion-section class="pdp__specs accordion">
        <div class="accordion__header" data-accordion-header aria-expanded="true">
          TECHNICAL_SPECIFICATIONS
        </div>
        <div class="accordion__content" data-accordion-content>
          <table class="spec-table">
            {%- if product.metafields.custom.rated_output -%}
              <tr>
                <td class="spec-table__key">RATED_OUTPUT</td>
                <td class="spec-table__value">{{ product.metafields.custom.rated_output }}</td>
              </tr>
            {%- endif -%}
            {%- if product.selected_or_first_available_variant.sku != blank -%}
              <tr>
                <td class="spec-table__key">SKU</td>
                <td class="spec-table__value">{{ product.selected_or_first_available_variant.sku }}</td>
              </tr>
            {%- endif -%}
            {%- if product.selected_or_first_available_variant.weight > 0 -%}
              <tr>
                <td class="spec-table__key">WEIGHT</td>
                <td class="spec-table__value">{{ product.selected_or_first_available_variant.weight | weight_with_unit }}</td>
              </tr>
            {%- endif -%}
            {%- if product.vendor != blank -%}
              <tr>
                <td class="spec-table__key">VENDOR</td>
                <td class="spec-table__value">{{ product.vendor }}</td>
              </tr>
            {%- endif -%}
            {%- if product.type != blank -%}
              <tr>
                <td class="spec-table__key">TYPE</td>
                <td class="spec-table__value">{{ product.type }}</td>
              </tr>
            {%- endif -%}
          </table>
        </div>
      </accordion-section>
    {%- endif -%}

    <div class="pdp__note txt-mono txt-dim">
      // NOTE: SPECIFICATIONS SUBJECT TO CHANGE WITHOUT NOTICE
    </div>
  </div>
</section>

<style>
  .pdp {
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    min-height: 90vh;
    border-bottom: 2px solid var(--c-border);
  }

  .pdp__gallery {
    border-right: 2px solid var(--c-border);
    background: var(--c-panel);
    display: grid;
    grid-template-rows: 1fr auto;
  }

  .pdp__main-image {
    position: relative;
    border-bottom: 2px solid var(--c-border);
    height: 60rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .pdp__main-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    filter: grayscale(20%);
  }

  .pdp__thumbnails {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--grid-gap);
    background: var(--c-border);
    padding: var(--grid-gap);
  }

  .pdp__thumb {
    background: var(--c-panel);
    cursor: pointer;
    height: 12rem;
    position: relative;
  }

  .pdp__thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.6;
    transition: 0s;
  }

  .pdp__thumb.active img {
    opacity: 1;
    filter: contrast(110%);
  }

  .pdp__thumb.active::after {
    content: '';
    position: absolute;
    inset: 0;
    border: 2px solid var(--c-accent);
    pointer-events: none;
  }

  .pdp__details {
    padding: var(--pad);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    max-height: 90vh;
  }

  .pdp__title {
    font-size: 5rem;
    margin-bottom: 0.5rem;
  }

  .pdp__price {
    margin-bottom: 2rem;
  }

  .pdp__description {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid var(--c-border);
  }

  .pdp__form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .pdp__quantity {
    margin-bottom: 1rem;
  }

  .pdp__add-btn {
    font-size: 1.6rem;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .pdp__specs {
    margin-top: 2rem;
  }

  .pdp__note {
    font-size: 1rem;
    margin-top: 1rem;
  }

  @media (max-width: 1024px) {
    .pdp {
      grid-template-columns: 1fr;
      min-height: auto;
    }

    .pdp__gallery {
      border-right: none;
      border-bottom: 2px solid var(--c-border);
    }

    .pdp__main-image {
      height: 40rem;
    }

    .pdp__details {
      max-height: none;
    }
  }

  @media (max-width: 600px) {
    .pdp__title {
      font-size: 3.5rem;
    }

    .pdp__thumbnails {
      grid-template-columns: repeat(3, 1fr);
    }

    .pdp__thumb {
      height: 8rem;
    }
  }
</style>

{% schema %}
{
  "name": "Product information",
  "tag": "section",
  "class": "section-product",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_specs",
      "label": "Show specifications accordion",
      "default": true
    }
  ]
}
{% endschema %}
